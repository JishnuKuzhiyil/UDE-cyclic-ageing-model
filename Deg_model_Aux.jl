module Deg_model_Aux

include("LGM50_parameters_SPMDeg.jl"); import .Para_set

#SEI model____________________________________________________

#const parameters
const C_solvent = 4541.0 # [mol/m³] solvent concentration in the electrolyte
const U_SEI= 0.4 # [V] Open-circuit potential of SEI reaction
const V_SEI = 0.162/1690 # [m³/mol] partial molar volume of SEI
const α_SEI = 0.5 # transfer coefficient of SEI reaction

function J_SEI_eval(L_SEI,η_SEI,T,D_SEI,K_SEI)

    F=96485.33289
    R = 8.3144598    
    J_SEI = C_solvent/(1/(K_SEI*exp(-α_SEI*F*η_SEI/(R*T))) + L_SEI/D_SEI) #Note that J_SEI in the model has chosen positive sign convension
    return J_SEI # J_SEI in [mol/m²/s]

end


#LiP model____________________________________________________

const α_LiP = 0.5 # transfer coefficient of LiP reaction
const V_LiP = 6.94e-3/534.0 # [m³/mol] partial molar volume of LiP

function J_LIP_eval(ηₙ,T,ΔC_n,K_LiP)

    F=96485.33289
    R = 8.3144598
    c_e = Para_set.c_e  
    J_LiP = K_LiP*c_e*(ΔC_n/Para_set.c_s_max_neg)*exp(-α_LiP*F*ηₙ/(R*T))
    return J_LiP # J_LiP in [mol/m²/s]

end


#LAM model____________________________________________________

const E_pos,E_neg = 375e9,15e9 # [Pa] Young's modulus of positive and negative electrode
const Ω_pos,Ω_neg = 12.5e-6,3.1e-6   # Partial molar volume of positive and negative electrode [m³/mol]
const ν_pos,ν_neg = 0.2,0.3 # Poisson's ratio of positive and negative electrode [-]
const σ_yield_pos,σ_yield_neg = 375e6,60e6 # [Pa] yield stress of positive and negative electrode

function positive_else_zero(x)
    return x > 0 ? x : 0
end


function Stress_driven_LAM_neg(ΔC_min_neg,ΔC_max_neg,β_neg,m_neg,M_σ_neg)
        
    σₕ_max = 2*E_neg*Ω_neg/9.0/(1-ν_neg) * (-1*ΔC_min_neg)
    σₕ_min = 2*E_neg*Ω_neg/9.0/(1-ν_neg) *(-1*ΔC_max_neg)

    σₕ_eff = (1+M_σ_neg)*σₕ_max  + (M_σ_neg-1)*σₕ_min

    der_bn = -β_neg*(σₕ_eff/σ_yield_neg)^m_neg *3/Para_set.Rn  #(3/Rn) is to convert ϵn to bn
    return der_bn
end


function Stress_driven_LAM_pos(ΔC_min_pos,ΔC_max_pos,β_pos,m_pos,M_σ_pos)

    σₕ_max = 2*E_pos*Ω_pos/9.0/(1-ν_pos) * (-1*ΔC_min_pos)
    σₕ_min = 2*E_pos*Ω_pos/9.0/(1-ν_pos) *(-1*ΔC_max_pos)

    σₕ_eff = (1+M_σ_pos)*σₕ_max  + (M_σ_pos-1)*σₕ_min

    der_bp = -β_pos*(σₕ_eff/σ_yield_pos)^m_pos *3/Para_set.Rp
    return der_bp
end

#Particle cracking model____________________________________________________

const t₀ = 3600.0 # [s] time for one cycle as per PyBamm model 
const b_cr = 1.12 #Stress intensity correction factor 
const ρ_cr = 3.18e15 #number of cracks per unit area [m⁻²]
const ω_cr = 5.86e-9 #crack perimeter [m]
const l_cr_0 =5.86e-9 #initial crack length [m]
const a_cr_0 = 3.84e5*l_cr_0*ω_cr*ρ_cr #initial crack area [m²/m³]


function Particle_crack_propogation(l_cr,a_cr, bn,ΔC,k_cr,m_cr)

    b_cr = 1.12
    σₜ = E_neg*Ω_neg/3.0/(1-ν_neg) *positive_else_zero(-ΔC)  
    
    dl_cr = (k_cr/t₀)*(σₜ*b_cr*sqrt(π*l_cr))^m_cr
    da_cr = ω_cr*ρ_cr*bn*dl_cr

    return dl_cr,da_cr

end 

#Neural betwork optimal weights
const pos__NN_para_weights=[0.18244714, -0.37005264, 0.25428954, 0.035493728, -0.01542828, 0.24866727, -0.27636915, 0.14688829, -0.336879, -0.13145678, -0.4288113, 0.10528361, -0.21065536, 0.036182735, -0.27561668, -0.015218304, -0.08862848, -0.1691757, 0.3247286, -0.31489837, 0.2110375, 
0.0030556063, 0.31084055, -0.03648369, 0.05267793, -0.26845467, 0.19411823, -0.47251835, -0.03225828, 0.52462196, 0.019089034, -0.2977913, 0.46496955, -0.19791813, 0.309882, -0.45992485, 0.61181796, -0.25141403, -0.29253292, 0.12916596, 0.3692972, 0.19628398, -0.14622612, -0.399083, 0.17080234, -0.11870555, -0.29090494, -0.28827566, 0.0014849347, 0.4733025, -0.28114074, 0.12251091, 0.5407909, 0.26216796, -0.44854882, -0.14997377, -0.05761339, 0.20186046, -0.07198936, -0.004005007, 0.06912899, -0.14438607, -0.1691751, -0.05419936, 0.05624656, -0.3368757, -0.2193643, 0.25642854, -0.047569007, -0.24747846, -0.20583439, -0.21117243, 0.3734109, -0.1948544, -0.53195274, 0.136134, -0.32243794, 0.6068798, -0.6091623, 0.72536206, 0.028627403, -0.005414159, 0.053865388, 0.024510458, -0.055871196, -0.3155081, -0.0010125976, 0.17157522, 0.15392356, 0.10225458, 0.052501947, 0.3883095, -0.17600691, 0.2259062, -0.16525826, 0.038709138, 0.17582296, 0.12893194, -0.3057933, 0.3483278, -0.14966862, -0.29065543, -0.31510073, 0.079792246, -0.1905922, -0.11936668, 0.21962693, -0.3459769, 0.07602866, 0.31892145, 0.28090006, 0.14363524, -0.22614975, -0.117360786, -0.0008633922, -0.30848286, 0.34037554, 0.010506215, 0.2100527, 0.13099183, 0.16890033, 0.10169758, 0.12847756, -0.11980137, 0.36624604, -0.39052537, -0.10937254, 0.35907075, 0.0663523, 0.11705377, -0.18229124, -0.032841567, 0.20601039, 0.0052570575, -0.30721563, 0.059143987, 0.2915921, -0.18113706, -0.09723509, 0.11236123, 0.03824921, -0.2553224, 0.11573294, -0.17989261, 0.2315958, 0.2299137, 0.100020394, 0.13798846, 0.23759769, 0.36534244, -0.31020278, -0.15672319, 0.016621418, -0.26399893, -0.16140163, -0.35902354, -0.0060620094, 0.17445971, -0.2275267, -0.0859768, -0.08527671, 0.08758048, -0.07278131, 0.06588472, -0.10076246, -0.06879128, -0.11089774, -0.32400927, 0.053907562, -0.3143247, -0.025049733, 0.37120375, -0.24573863, 0.12950358, -0.35532156, 0.27018064, -0.35322005, -0.049448375, -0.36692992, 0.005642357, -0.05287429, -0.22988625, 0.38859463, 0.010154132, 0.17682947, 0.18670212, -0.08670119, 0.19100495, 0.40870407, -0.20633766, 0.0022458946, -0.41875175, 0.36915737, 0.15055707, 0.19263203, -0.39366877, 0.31030166, 0.29257202, 0.05943371, -0.38338393, -0.31941158, -0.013073505, 0.12294832, -0.08090746, -0.33117086, -0.08585943, 0.09972841, 0.3203007, -0.482335, 0.28482527, -0.15794188, -0.27723432, 0.17044485, 0.19115512, 0.4023599, 0.30662674, 0.2517557, 0.14759831, -0.040125016, -0.21878389, 0.38146454, -0.17019236, 0.004749053, 0.4149813, 0.15640587, -0.02926435, 0.15084077, 0.23660709, -0.31938502, -0.37269822, 0.32826924, -0.19446515, 0.10301329, 0.22218813, -0.30887204, 0.30394915, -0.31250432, 0.2036336, -0.07970209, -0.16999847, -0.22743905, -0.37942183, -0.10391, -0.30278432, -0.23077732, -0.117835894, -0.30364046, 0.1271193, 0.2726229, -0.18422021, 0.34927714, -0.17773344, -0.28733188, 0.27929258, -0.044621784, -0.021641063, -0.08448565, -0.064628944, 0.18600634, 0.16914415, 0.36228436, -0.08257066, 0.30160332, -0.24413942, -0.34141824, 0.29907483, -0.062488247, -0.2377193, 0.10726539, 0.34984562, -0.13727938, -0.08830494, -0.064058386, -0.026350357, 0.025282957, -0.003219076, -0.08506225, 0.00915823, -0.064038046, -0.113833934, -0.23997648, 0.29464674, 0.033331655, -0.34957877, 0.33621705, -0.07079713, -0.20588416, -0.029517155, 0.03876252, -0.3669012, 0.2549232, -0.08838965, -0.18284237, -0.132072, -0.059926018, -0.12822051, -0.30457744, 0.22240353, -0.33051202, 0.17037877, 0.12652981, -0.3054364, 0.15844421, 0.066165514, 0.02868678, 0.3279835, -0.20231675, 0.06931916, 0.25984928, 0.33742684, 0.29416567, -0.21409944, 0.13431597, -0.13121475, 0.35302204, 0.2240403, 0.28967747, -0.17299832, 0.1668472, -0.3161433, -0.11604901, -0.05384129, -0.3354625, -0.015272906, 0.3379736, 0.07945341, -0.07697199, -0.06600553, 0.07321461, -0.24124932, -0.2645206, 0.21692069, -8.3736806e-5, 0.35109288, -0.301879, 0.2327638, -0.3078894, -0.16211677, 0.25414717, 0.3177362, -0.33377606, 0.0736303, 0.35647902, -0.32876042, -0.3281378, 0.36476833, 0.13390173, -0.23608641, -0.14112426, 0.04287313, 0.009564681, -0.32661387, 0.2447164, 0.29076886, 0.22440003, 0.28906962, 0.22769983, -0.21091692, 0.35404047, -0.027288264, -0.36356646, -0.343374, -0.43533665, 0.30121174, 0.36072275, -0.026150942, -0.3561563, -0.33677545, 0.06712212, 0.057206653, -0.036471106, 0.008814681, 0.2757081, 0.18410055, 0.16050056, -0.3102683, -0.1938377, -0.37766656, 0.1450421, 0.4038523, 0.26664832, 0.04107433, 0.0975353, 0.37986523, 0.31156912, -0.25657362, -0.2880591, -0.33135498, 0.3375181, -0.063030966, 0.02762123, -0.47801366, 0.24675074, 0.19185719, -0.19205123, 0.19685034, -0.33532053, -0.3802583, -0.083717465, -0.30144608, -0.3701126, 0.3066613, 0.0846704, -0.038162116, -0.31477427, -0.33914936, -0.37601578, -0.20906878, -0.19794823, 0.34251502, -0.35687658, 0.1636126, 0.31385562, -0.37200987, 0.18821721, 0.22941536, 0.33010572, -0.07893849, -0.2835344, -0.1284077, -0.26431423, 0.1592986, 0.13109489, -0.07901176, -0.10191083, 0.13003036, 0.25109494, -0.1723717, -0.1398741, -0.36623222, 0.3437262, -0.00927222, 0.35620278, 0.08894694, -0.09008247, 0.28795826, -0.12425681, 0.33823442, 0.20442598, 0.12710702, 0.37822443, 0.15305153, 0.35015634, 0.35173288, -0.37241971, -0.3167625, 0.07694445, 0.2809757, 0.2890547, 0.0902879, 0.3068995, 0.08376315, -0.37516862, 0.03791375, -0.07459404, -0.13833986, 0.23943767, 0.23784877, -0.26778373, 0.24342774, -0.37670028, 0.017189978, 0.3884379, -0.12432068, -0.06416, -0.23328945, -0.05067007, 0.20204785, 0.28015035, -0.19693096, 0.02916261, -0.26948795, -0.34849328, -0.2756225, -0.15934195, -0.11250188, -0.21021616, 0.24806273, 0.14584124, 0.19787373, 0.39968884, -0.40733013, 0.20431358, 0.18973787, 0.20957373, 0.14914943, -0.22464022, 0.3237199, 0.13355294, 0.13964444, 0.46414712, 0.32919767, -0.10706258, -0.15524025, -0.20568185, -0.04628276, -0.0067573325, -0.013262516, -0.17680198, 0.19498767, 0.0156115955, 0.002286274, 0.03299069, -0.008931901, -0.020125998, 0.036943924, 0.017923294, -0.021695687, 0.09738688, 0.019081255, -0.033322748, -0.0063585704, 0.030456351, -0.0026838526, -0.0029335893, -0.019238409, -0.00015697944, 0.0033395335, 0.0104025975, -0.020517189, -0.07717578, -0.2726915, -0.42878395, 0.13937318, 0.22097246, -0.020752523, -0.15728575, 0.09733202, -0.0006542179, -0.07985915, 0.4457367, 0.5181797, -0.113646865, 0.051491443, -0.19598219, 0.28387043, -0.22855574, 0.06754118, -0.24917328, 0.13378309, -0.019996235]

const neg_NN_para_weights =[-0.061506025, -0.10001473, 0.07948991, -0.016158527, -0.48820263, 0.2099531, -0.34660086, -0.1083796, -0.09052395, 0.3222179, 0.19776115, 0.021966252, 0.4472355, 0.4826219, 0.009701525, -0.45297888, 0.45018092, 0.2045827, -0.3832041, 0.21490777, 0.045408487, -0.44398683, -0.55072755, 0.11888645, -0.030983908, 0.6054536, 0.15291667, -0.022808023, 0.45691487, -0.2242245, -0.16979182, 0.5690382, -0.22725525, -0.009122151, -0.19770035, -0.030987319, -0.14194982, 0.12244314, -0.07843249, 0.33622313, -0.36475477, 0.13478121, 0.16464911, -0.5618471, -0.4084963, 0.08029418, 0.2755657, -0.31999806, 0.08064465, -0.15794325, -0.5999859, -0.074547485, 0.41598403, -0.17218092, -0.26213253, 0.07572043, -0.34047046, 0.13852574, 0.47021547, -0.22927576, -0.31672475, 0.11907082, 0.04655055, 
0.3365918, -0.41004896, -0.46178967, 0.36230704, 0.6837832, -0.11119631, 0.490241, -0.3999156, -0.2292365, -0.3113954, 0.018850444, 0.27850088, 0.28369305, -0.3565364, -0.44486424, 0.3705062, 0.0016323833, 0.061077785, -0.02454647, -0.021121377, -0.43759465, 0.056428317, -0.07956142, -0.07402011, 0.31754312, -0.26114833, -0.097773254, -0.28371263, 0.14882793, 0.09164066, -0.13410638, 0.42719844, 0.036118973, -0.02446417, -0.021100234, 0.1548216, -0.06095781, -0.17593086, 0.123600274, -0.010803914, 0.34287095, 0.31968883, -0.18706039, -0.296733, -0.20067774, -0.14542325, -0.30113965, -0.20284146, -0.0057298127, -0.3951444, -0.21681832, 0.25928393, 0.11625624, -0.23239902, 0.27438232, 0.16669564, 0.021996737, 0.38605127, -0.15185975, 0.19361067, -0.25031334, -0.2087044, -0.30799544, 0.12936622, 0.23134266, 0.38960618, -0.012414303, -0.26799586, -0.2986146, 0.21643722, -0.05739292, -0.17133026, 0.095870025, -0.3350945, -0.32769957, 0.14022736, -0.24347141, -0.32827055, 0.32725918, 0.16521631, 0.1732523, 0.057509333, 0.010058071, 0.29440254, 0.1559717, 0.06954689, 0.030053534, -0.11072779, 0.38643843, 0.10735517, -0.35624388, -0.23756981, 0.104112886, 0.06836133, 0.0039894963, 0.16044876, 0.09773836, -0.22605391, 0.22769001, 0.27543336, -0.31443292, 0.18130663, 0.09904564, 0.20578839, -0.3000759, 0.16478068, -0.1940811, -0.314377, -0.31205702, -0.12019945, 0.108676, 0.09344608, 0.2070468, -0.3227585, 0.2682282, 0.3501571, 0.3451827, 0.08877885, 0.21303992, -0.09150793, -0.32758686, -0.19343582, -0.41090718, 0.33122504, 0.2536491, 0.21157745, -0.2099809, 0.36799085, 0.3648303, -0.29077396, -0.15230782, -0.4011926, 0.206777, 0.0065147844, 0.17139949, -0.11889121, 0.04810476, 0.1540929, 0.4067609, -0.3656162, -0.12780778, 0.13322343, 0.08108637, -0.34218898, 0.0925111, 0.3617868, 0.14662714, 0.29817683, -0.027754955, -0.34917822, -0.37244257, 0.16338699, 0.030910918, -0.12627386, -0.11526705, -0.08148829, 0.17983551, 0.33590016, 0.06383764, -0.019452479, -0.3987537, -0.22447859, 0.27470532, 0.17099397, 0.11050964, 0.0005463515, 0.0504245, 0.008938824, 0.010767887, -0.084905855, 0.36530808, 0.045228314, 0.05675804, 0.41891128, -0.13262592, 0.28807157, 0.4398493, 0.1888766, -0.04879168, -0.3172995, 0.24227113, 0.008410793, 0.10886942, -0.42508695, 0.4520318, 0.26027915, -0.011789208, -0.23448417, -0.39933893, 0.051107027, 0.08058547, -0.036963534, 0.012825054, 0.25766465, 0.20924069, 0.012949874, 0.09642117, 0.199678, 0.32217106, 0.124516785, -0.2592005, 0.2989862, 0.20202112, 0.32802626, -0.26588655, 0.0016972639, 0.08365889, -0.22940913, 0.27790952, 0.20486867, -0.00929756, 0.038299214, -0.0971757, 0.009780811, 0.1063989, 0.14295554, -0.24972133, -0.3366421, 0.16571744, -0.03953163, 0.12460693, -0.10612102, 0.23267058, 0.042180434, -0.08582799, 0.38124403, -0.005680971, -0.5037571, 0.4920602, 0.04953773, -0.21650025, -0.15184727, -0.04778078, 0.18700416, -0.3707822, -0.5023545, -0.36476085, -0.2174784, 0.018951459, -0.029974572, -0.42231175, 0.036651388, 0.003301752, -0.008278871, 0.16339445, -0.24323305, 0.19212599, -0.1345087, 0.2886227, 0.29879332, -0.30523175, 0.082175, -0.43797278, -0.48714703, 0.23518367, 0.02442144, 0.3772504, -0.3402261, -0.39149877, -0.06427728, -0.31377852, 0.34224185, 0.10328813, -0.04583549, 0.39865053, -0.055390418, 0.42554986, -0.26574695, -0.17506425, -0.06700817, -0.30769286, -0.11925402, 0.20957999, 0.019943995, -0.37095574, -0.10740827, 0.26365587, -0.2921273, -0.31359115, 0.14191695, 0.40408954, 0.42336428, 0.29630816, 0.35692084, 0.11306417, -0.08748223, -0.22944571, 0.25629127, 0.2943881, 0.28637815, -0.038090307, -0.027074302, -0.12967265, -0.3870396, -0.20623441, -0.29564044, 0.20214811, 0.21932422, -0.051268537, -0.15614158, 0.12502137, -0.30971414, -0.104673356, -0.045868956, 0.1514897, 0.26633754, 0.096390866, 0.30239657, 0.26747844, -0.3418265, -0.18858965, 0.16244537, 0.2703085, 0.009714009, -0.3043441, 0.28834668, -0.34915584, 0.18521199, -0.18890323, -0.2417631, 0.34835812, 0.1560166, 0.13904524, -0.23389468, 0.3411535, -0.3344399, -0.087767385, 0.41097155, 0.35443634, -0.15166545, 0.26467124, 0.27559268, -0.13271187, 0.04207743, -0.18057658, -0.36038393, -0.11513227, 0.38177788, 0.09446729, -0.057609703, 0.052227117, -0.028951025, -0.047246475, -0.23917983, -0.07546946, 0.41153044, -0.20534046, -0.08360648, -0.12524262, -0.26357308, -0.33017159, 0.21785441, 0.05385781, -0.28867453, -0.011477691, 0.23745884, 0.021205874, -0.3079358, -0.003645405, 0.35673675, 0.08645232, -0.23398176, -0.2139438, 0.2514424, 0.123372674, -0.20828216, -0.1878078, 0.24158637, 0.040047996, -0.2535041, 0.17922424, 0.112038806, 0.16823421, -0.0920675, 0.22082837, 0.0293205, 0.12902156, 0.28072512, -0.18250415, -0.25881177, -0.034914214, -0.2955272, 0.27489123, -0.31850436, -0.112045474, -0.21327452, -0.32068413, -0.14158653, -0.41071585, -0.29765335, 0.080882, 0.4008352, -0.036874972, 0.1446824, -0.28870165, -0.28800273, 0.28597334, 0.20415464, -0.12126585, -0.0087217055, 0.15530507, 0.12366415, 0.21521527, 0.21494061, 0.38010338, 0.19820392, -0.10576566, -0.22982277, -0.2803624, 0.008347724, -0.15390672, -0.24443743, -0.12173829, -0.2575441, -0.16274421, -0.07852827, -0.34014264, 0.11611945, 0.13026479, 0.18983288, 0.19863577, -0.20743309, 0.026692076, 0.35146004, 0.17678332, -0.25435314, -0.13291211, 0.06113623, -0.040709496, 0.34565762, 0.14719999, 0.29244894, -0.11413159, -0.0373107, 0.1624638, -0.2658317, 0.22960608, -0.009295919, 0.025340766, 0.01622931, 0.027520267, -0.017053453, 0.041322287, 0.011404318, -0.0065784026, -0.02358035, -0.016074495, -0.011363884, -0.039479125, 0.008269802, -0.036747217, 0.056569997, -0.024350844, -0.012960333, -0.04505559, 0.014600787, 0.029225621, 0.45204723, 0.2727941, 0.4802592, -0.40953782, -0.46660644, 0.4771481, 0.25318438, -0.16598837, -0.04986218, -0.039187886, -0.5401142, 0.30616194, 0.13835149, -0.12628047, 0.45431063, -0.2633096, -0.4762769, -0.075202785, -0.38483593, 0.19534263, 0.03295692]

    
end # module

